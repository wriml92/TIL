오늘 SQL 코드카타에서 셀프 조인(self join)에 대해 나와서 이 부분을 잘 몰라 문제를 잘 못 풀었다. 그래서 이 셀프 조인에 대해 잘 알아보고자 한다.   

---

&emsp;MySQL에서 <u>셀프 조인(self join)</u>은 하나의 테이블을 대상으로 자기 자신과 조인하는 방식이다. 이는 테이블의 데이터를 다른 데이터와 비교하거나 특정 관계를 표현해야 할 때 사용된다. 

&emsp;예를 들어, 조직의 계층 구조(부서와 상사), 제품의 부모-자식 관계 등을 분석할 때 셀프 조인을 사용할 수 있다.

---

### 셀프 조인의 특징
- **단일 테이블 사용**: 셀프 조인은 하나의 테이블만 사용하지만, 그 테이블을 두 개로 나누어 다루는 것처럼 작동한다.
- **별칭 사용**: 동일한 테이블을 두 번 참조하므로, 두 테이블을 구분하기 위해 별칭(alias)을 사용해야 한다.
- **INNER JOIN 또는 OUTER JOIN**: 셀프 조인은 일반적으로 `INNER JOIN`이나 `LEFT JOIN` 같은 일반적인 조인 방식을 따른다.

---

### 셀프 조인의 문법
```sql
SELECT 
    A.컬럼1, 
    B.컬럼2
FROM 
    테이블명 A
INNER JOIN 
    테이블명 B 
ON 
    A.조건컬럼 = B.조건컬럼;
```

---

### 예제: 직원 테이블에서 상사 찾기
&emsp;직원 테이블에 직원(employee)과 상사(manager)의 관계가 저장되어 있다고 가정을 해 보자.

#### 테이블: employees
| employee_id | name    | manager_id |
|-------------|---------|------------|
| 1           | Alice   | NULL       |
| 2           | Bob     | 1          |
| 3           | Charlie | 1          |
| 4           | David   | 2          |

#### 목표
각 직원과 그 상사의 이름을 가져오고 싶다.

#### SQL 쿼리
```sql
select 
    e.name as employee_name,
    m.name as manager_name
from 
    employees e
inner join 
    employees m
on 
    e.manager_id = m.employee_id
```

#### 결과
| employee_name | manager_name |
|---------------|--------------|
| Bob           | Alice        |
| Charlie       | Alice        |
| David         | Bob          |

---

### 셀프 조인을 활용할 때 주의사항
1. **별칭 사용 필수**: 셀프 조인에서는 동일한 테이블을 두 번 참조하므로, 각 테이블에 별칭을 지정해야 한다. 별칭이 없으면 쿼리가 혼란스러워지고 오류가 발생할 수 있다.
2. **필요한 데이터만 선택**: 셀프 조인은 많은 데이터 비교를 수행하므로, 조건을 명확히 지정하여 불필요한 데이터 처리를 줄이는 것이 중요하다.
3. **성능 최적화**: 데이터량이 많으면 셀프 조인이 성능에 영향을 줄 수 있다. 인덱스를 설정하거나 쿼리를 최적화하여 성능 문제를 완화할 수 있다.

---

### 활용 사례
1. **계층 구조 처리**: 조직도, 카테고리 트리 등 상위-하위 관계를 표현할 때 사용한다.
2. **중복 데이터 비교**: 같은 테이블에서 중복된 데이터를 찾거나 비교할 때에도 사용한다.
3. **시간 데이터 비교**: 이전 데이터와 현재 데이터를 비교하여 변화 추적에도 사용한다.

&emsp;셀프 조인은 매우 유용하지만, 잘못 사용하면 성능 저하를 초래할 수 있으므로 주의가 필요하다.